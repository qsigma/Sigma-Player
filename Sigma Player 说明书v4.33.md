# Sigma Player 说明书
适用于 Sigma Player v4.33 & Sigma Player Pro v4.24

## 欢迎使用
### 运行 Sigma Player
- 运行 Sigma Player 前，请确保运行的系统为 win10 及以上版本。
- 解压 Sigma Player 压缩包，在目录中找到后缀为.exe 的文件，右击后选择以管理员身份运行。 
> - 如果直接双击了.exe 文件，则软件会弹出获取管理员权限的窗口，点击确认后会摧毁原先的窗口，生成获取了管理员权限的新窗口。
> - 如果无法打开软件，可能需要您检查互联网连接、暂时关闭 VPN 代理

### Sigma Player 内含物清单

| 软件目录             | 文件名称                              | 说明                          |
|----------------------|---------------------------------------|-------------------------------|
|  -  |Sigma Player (Pro) vx.x.exe                               | 软件本体                      |
| - | Sigma Player 使用说明.pdf              | 软件说明书                    |
| audios               | 风物之诗琴, ……                         | 软件的内置音源                |
| autosave             | flowsave.txt                           | 存放流式编曲自动保存的文件    |
|                      | mainsave.txt                           | 存放主文本框自动保存的文件    |
| config               | config.json                            | 软件的配置文件                |
| icons                | icons.ico, pin.png, ...                | 软件的图标等图片文件          |
| sheets               | ...                                    | 存放曲谱                      |
> 缺失上述文件夹可能导致 Sigma Player 无法正常运行。在不修改文件夹名称的前提下，您可以创建新的文件夹用于存放 midi 文件或其它用途。

### 验证 Sigma Player Pro
- Sigma Player Pro 包含了 midi 转谱的独家功能以及标准版的全部功能。如果您是 midi 制曲者或者高水平手弹玩家，可以前往 [https://wjx.cn/vm/e3srfbj.aspx](如下问卷地址) 申请使用 Sigma Player Pro。
- 在填写申请问卷前，您需要准备好**活跃平台的账号主页截图、设备的MAC地址和联系邮箱**；如果您的申请审核通过，我们会给您的邮箱发放激活码。
- 如果您获得了 Sigma Player Pro 的使用资格，请在所提交机器码的设备上解压 Sigma Player Pro 的安装包，双击.exe 文件，输入发放的激活码。此后，您可以正常使用，无需再次验证.

> - 发放的激活码仅限本台设备使用，无法在不同的设备上激活。
> - 如果您复制了激活码但是无法正常激活，请试着手动输入；如果发现软件显示的 MAC 地址与您提交的 MAC 地址不一致，请关闭 VPN 后重试。
### 更新版本
Sigma Player Pro v4.2、Sigma Player v4.3 及以上版本配备在线热更新功能，软件会在运行时检测是否有更新可用。如果检测到新版本，软件左上角会出现如下图标：

<img width="415" alt="image" src="https://github.com/user-attachments/assets/73537878-8496-48d2-899f-499699f48991">

点击之后会跳出如下对话框

<img width="445" alt="image" src="https://github.com/user-attachments/assets/18063cfa-3f7e-4212-ae7d-d3d0cc22dc3e">

您可以了解新版本的更新内容，点击按钮下载新版本的 exe 文件，按照对话框的指示，将它放在您现在软件的同位置下，然后删除旧版本 exe 文件。
### 卸载软件
将软件文件夹直接删除即可完成卸载。
> 如果您遇到了删除报错，请尝试右键任务管理器，查看后台进程中是否有残留的 Sigma Player 进程。
### 权限、隐私与账号安全问题
- 为了保证软件的正常运行，您需要提供**管理员权限**，以实现自动演奏功能的正常运行。
- 为了保证软件的正常运行，您需要保证设备**接入互联网**，以获取可用更新和公告。VPN 的开启可能会导致软件无法正常运行。请注意，软件只会从 gitee 的项目中获取信息，而不会上传您的任何信息。
- 为了保证软件的正常功能运作，软件可能会**读取，修改或删除**您的 Sigma Player 文件夹中的琴谱、图标、音源等文件。
- 在自动演奏中，软件会操纵您的**键盘**进行**虚拟输入**。
- Sigma Player 不会修改游戏内数据，因此不会导致任何进行自动演奏的游戏封号，请您放心使用。

## 界面说明
### 了解软件的各个界面
当前版本的 Sigma Player 由四个页面构成。

#### 音频中枢
在这个界面无需打开游戏，即可进行手弹练习；同时也是练习模式、自动演奏按键指示、Midi 播放的入口。

<img width="702" alt="image" src="https://github.com/user-attachments/assets/877ef830-fdb5-472a-bb79-5dfd9ab7fd1e">

#### 琴谱转换
在这个界面可以编辑琴谱，调用丰富的琴谱格式转换功能，或使用换行、排序等功能按钮。

<img width="706" alt="image" src="https://github.com/user-attachments/assets/aed4c2c8-9209-442b-ab52-9c7c0a8e955a">

#### 流式编曲
在这个界面可以使用双向同步的文本框和瀑布流，创作自己的作品，或者进行手弹录制。也是 Sigma Player Pro 的 Midi 转谱的入口。

<img width="709" alt="image" src="https://github.com/user-attachments/assets/fb9889fa-ffa7-46be-8039-f8c1ea6edd7f">

#### 关于软件
在这个界面可以查看赞助鸣谢、公告系统、更新日志和快捷链接。

<img width="728" alt="image" src="https://github.com/user-attachments/assets/782a5828-289c-43ef-a36a-8fcec04e4d7c">

### 顶部与底部的常驻 UI
- 顶部的常驻 UI，包含导入琴谱和几个使用软件时的图标按键。

<img width="540" alt="image" src="https://github.com/user-attachments/assets/fd13f578-8c77-4d65-a156-e8e2661b314d">

  1. **图钉**：点按后会变成<img width="17" alt="image" src="https://github.com/user-attachments/assets/baabc154-8c08-4c21-ab2f-ccd758b1736c">，表示软件窗口具有了置顶的特性；再次点按则取消置顶；
  2. **皮肤**：点按后为软件更改配色方案。将在以下五种颜色中轮替；
  > 在部分功能打开时，皮肤按钮不可用。

<img width="706" alt="image" src="https://github.com/user-attachments/assets/446498d8-710e-4f01-9391-2698a90a2fd5">

  3. **刷新**：点按后刷新琴谱目录、检测版本更新。
- 底部的常驻 UI，包含自动演奏进度条和控制中心。

<img width="506" alt="image" src="https://github.com/user-attachments/assets/b8633625-77db-45d9-9858-df7bd2fef402">

  
控制中心允许您切换音频输出的模式，具体参数可以在[[自动演奏]]章节查阅。

## 自动演奏
> - Sigma Player 原生支持自动演奏 Sigma-呱呱谱格式的琴谱，以及 Midi 文件。对于其它格式的琴谱如何通过琴谱转换实现自动演奏，请参考【琴谱转换】章节。
> - 在自动演奏文本琴谱与 Midi 文件时，Sigma Player 均支持速度调节、暂停中止。

### 选择琴谱文件
首先，您需要将待演奏的琴谱导入 Sigma Player，您可以选取下列任一方式。
- **从顶部下拉菜单中选择**。下拉菜单会读取 sheets 文件夹的文件列表，以及自动保存的两个文件选项。单机任一区域，会调出对应 txt 文件的内容，并显示在软件的文本框中。在软件包中，我们提供了几个示例文件。更多的琴谱资源需要您另行获取。

<img width="364" alt="image" src="https://github.com/user-attachments/assets/99cc0354-195a-49c9-8470-e62a17ba654d">
 
 > - 单击刷新按钮，会更新琴谱目录。
 > - 如果您的 sheets 文件夹内容过多，无法快捷的找到想要的结果，则可以输入任意关键词，然后再点击下拉，则软件会执行搜索功能，并只显示搜索结果。
- **从浏览文件按钮选择**。浏览文件按钮会弹出选择文件的会话窗口，路径为您上一次选择文件的路径。您可以选择.txt 或.mid 文件导入。
- **直接复制琴谱到文本框**。您可以直接将琴谱复制到【琴谱转换】的文本框中。

### 自动演奏的三种输出模式
在底部控制栏，您可以从点按、长音、音频中任意点亮一个模式，并使软件按该模式输出。
> - 当任一模式点亮，软件进入响应状态，此后按 1 即可开始自动演奏。如果您希望退出响应状态，不被正常按键误触发，可以再次点击同一模式，则鼠标移开后控制中心会变为全灰状态。您还可以按下 esc 键达到相同效果。
> - 当练习模式开启时，您无法退出响应状态。但是如果您没有按下练习模式的【开始】，则不必担心按键误触发，详见【练习模式】章节。
- **点按**：当自动演奏读取到对应琴键时，会调用 pynput 库的 tap 方法，短按一下对应虚拟按键并立即松开。这个模式适用于仅由按键触发声音、不依赖松开按键停止发声的游戏内乐器，例如所有的原神乐器。
- **长音**：当自动演奏读取到对应琴键时，会调用 pynput 库的 press 方法，将对应虚拟按键设置为按下状态；在持续到延时符号结束、下一组按键进入，或读取到▲符号时，调用 pynput 的 release 方法，将所有虚拟按键设为抬起状态。这个模式适用于需要由按键的按下、抬起触发声音开始、停止的乐器，例如逆水寒的长笛。
- **音频**：此模式下软件仅会调用自身的音色库，播放对应按键的声音，而不会进行自动演奏。
> 从实现的原理来看，长音与点按彼此不兼容。使用其中一个模式弹奏另一个模式的乐器，都会触发异常效果，因此您需要在演奏前保证选择了正确的输出模式。

### 如何进行自动演奏
- 在选择任一输出模式，使软件进入响应模式后，按 `1` 即可触发自动演奏。如果此时演奏区不在 Midi 模式，则会自动演奏文本框中的内容；否则，演奏选中的 Midi 文件。
- 在自动演奏过程中，如果模式选择并非音频，则需要将鼠标焦点放置在对应游戏内乐器上。也即，对于原神而言，自动演奏的流程是：打开原琴，选择【点按】模式，然后点击原琴界面后按 `1`。
- 在自动演奏中，还可以通过快捷键实现中止、暂停、变速等操作。具体指令为：
```text
按下 2：中止演奏；此后可编辑琴谱，按 1 从琴谱开头开始演奏；
按下 3：暂停演奏；在暂停位置生成标识■，此后可编辑琴谱，按 1 从■处开始演奏；
按下 4：加速：变速倍率减少 0.1，至少为 0.5；
按下 5：减速，变速倍率增加 0.1，至多为 2；
```
 您可以参考【按键指示】上的状态指示。

<img width="487" alt="image" src="https://github.com/user-attachments/assets/faccba12-0a22-4963-b24d-7ada6d10b779">


软件进入响应模式时，【1 播放】被高亮；按下 1 后，【1 播放】取消高亮，【2、3、4、5】亮起。软件会实时指示您在何时可以按下哪个按键。例如，练习模式下【3 暂停】不会亮起；临时变速到达极限时对应的【4 -】或【+ 5】不会亮起。
### Midi 文件的自动演奏
想要自动演奏 Midi 文件，需要点按浏览文件按钮，将文件类型选为.mid。此时会弹出 Midi 区的 UI，软件进入 Midi 模式。此后，自动演奏的各种操作与文本琴谱的完全一致。

<img width="472" alt="image" src="https://github.com/user-attachments/assets/8c171246-3ab6-4984-8524-eac1e3055f69">

由于无法获知 Midi 文件的调式，我们会在每个调式下计算黑键的个数，并取数量最小的那个方案作为 C 调。在 Midi 区您可以对调式进行进一步的配置。
- 点击最右侧的按键，可以选择在当前定调下，黑键音符的处理方法。可以在黑键靠上、黑键靠下、黑键略去中选择。
- 点击右侧倒数第二个数字，可以修改调式
  ```text
  如果想要在软件自动配置的调式上增加一个八度，则在输入的数值上减 12；如果想要增加一个调，则在输入的数值上减 1，以此类推。
  ```
